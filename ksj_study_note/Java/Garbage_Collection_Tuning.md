# 가비지 컬렉션(GC)과 JVM 튜닝

---

## 🔹 가비지 컬렉션(GC) 개요

자바의 **가비지 컬렉션(GC)**은 메모리 관리 시스템의 일환으로, 더 이상 사용되지 않는 객체들을 자동으로 **삭제**하여 **힙 공간을 회수**하는 메커니즘이다.  
GC는 **메모리 누수 방지**와 **자동 메모리 회수**를 통해 개발자가 메모리 관리를 수동으로 하지 않도록 돕는다.

JVM의 **Heap** 영역에 생성된 객체는 일정 시간이 지나면 **참조되지 않거나** 더 이상 사용되지 않는 상태가 된다. 이를 GC가 자동으로 감지하여 **불필요한 객체**를 메모리에서 제거한다.

---

## 🔹 GC의 동작 과정

1. **객체 생성**: 객체가 힙에 할당된다.
2. **참조 확인**: 객체에 대한 참조가 더 이상 없다면, GC가 그 객체를 제거 대상으로 지정한다.
3. **가비지 수집**: 사용되지 않는 객체가 메모리에서 제거된다.
4. **힙 공간 회수**: GC가 수행된 후, 회수된 메모리는 다시 사용 가능한 상태가 된다.

---

## 🔹 GC의 주요 종류

| GC 종류       | 특징                                           | 용도                        |
|---------------|-----------------------------------------------|-----------------------------|
| Serial GC     | 단일 스레드, 간단한 GC                       | 작은 어플리케이션            |
| Parallel GC   | 멀티스레드를 사용하여 GC 수행                | 멀티코어 환경에서 성능 향상  |
| CMS (Concurrent Mark-Sweep) GC | 멀티스레드로 **짧은 정지 시간** 목표   | 실시간성 요구가 있는 애플리케이션 |
| G1 (Garbage-First) GC | 최신 GC, 높은 응답성과 성능 최적화      | 대규모 애플리케이션           |

---

## 🔹 가비지 컬렉션의 세대별 관리

GC는 힙 영역을 **Young Generation**, **Old Generation**, **Metaspace**로 나누어 각각의 영역에서 다르게 처리한다.

1. **Young Generation**
   - 새로운 객체가 할당되는 영역
   - **Minor GC**는 이 영역에서 발생하며, 객체가 오래되지 않으면 여기서 제거된다.
   
2. **Old Generation**
   - 오래된 객체가 이동하는 영역
   - **Major GC** 또는 **Full GC**는 Old Generation에서 발생하며, 긴 정지 시간을 초래할 수 있다.

3. **Metaspace**
   - 클래스 메타데이터가 저장되는 영역
   - Java 8부터 PermGen 영역을 대체

---

## 🔹 GC 튜닝과 최적화 전략

### 1. **GC 로그 분석**
   GC 로그를 분석하여 **힙 메모리의 사용 패턴**과 **GC가 발생하는 주기**를 파악한다.  
   - `-Xloggc:<file-path>` 옵션으로 GC 로그를 저장할 수 있다.
   
### 2. **JVM 메모리 크기 설정**
   - `-Xms` : 초기 힙 크기
   - `-Xmx` : 최대 힙 크기
   - `-XX:MaxMetaspaceSize` : 메타스페이스 크기 설정

### 3. **Garbage Collection 옵션**
   - `-XX:+UseG1GC`: G1 GC 사용
   - `-XX:+UseParallelGC`: Parallel GC 사용
   - `-XX:+UseConcMarkSweepGC`: CMS GC 사용

### 4. **힙 크기 조정**
   - Young Generation 크기를 늘리면 Minor GC의 빈도를 줄일 수 있으나, **Major GC**의 비용이 커질 수 있다.
   - Old Generation 크기를 적절히 설정하면, **Full GC의 빈도**를 줄일 수 있다.

---

## 🔹 JVM과 GC 성능 최적화

- **GC가 자주 발생하면 애플리케이션 성능 저하**가 발생할 수 있으므로, GC를 **최소화**하는 것이 중요하다.
- **메모리 할당 최적화**: 필요 이상으로 큰 객체를 생성하지 않도록 하고, **객체의 수명**을 최대한 짧게 만든다.
- **병렬 및 멀티스레딩 지원**: 멀티코어를 활용하여 GC 성능을 최적화할 수 있다. `Parallel GC` 또는 `G1 GC` 옵션을 사용하면 여러 CPU 코어에서 GC를 병렬 처리할 수 있다.

---

## ✅ 정리 요약

- 가비지 컬렉션(GC)은 자바에서 자동 메모리 관리를 제공하여, 더 이상 사용되지 않는 객체를 자동으로 제거하고 메모리를 회수한다.
- GC는 **Young Generation**, **Old Generation**, **Metaspace** 등 세대별로 객체를 관리하며, **Minor GC**와 **Full GC**가 각각 다르게 수행된다.
- GC 최적화는 **JVM 튜닝**을 통해 성능을 크게 향상시킬 수 있으며, 이를 위해 **메모리 크기 설정**과 **GC 옵션 조정**이 필요하다.
