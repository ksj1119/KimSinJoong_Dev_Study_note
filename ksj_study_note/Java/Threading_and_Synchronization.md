# 멀티스레딩과 동기화

---

## 🔹 자바에서의 스레드 개념

스레드는 하나의 프로세스 내에서 **독립적으로 실행되는 작업 흐름**이다.  
Java에서는 JVM이 관리하는 **JVM 스레드 스케줄러**를 통해 사용자 정의 스레드를 생성하고 실행할 수 있다.

멀티스레드는 다음과 같은 목적에서 사용된다:

- 동시에 여러 작업을 처리 (예: 사용자 입력 + 백그라운드 연산)
- I/O 대기 시간 동안 CPU 활용 극대화
- 병렬 연산을 통한 성능 최적화

---

## 🔹 스레드의 생명주기

자바의 스레드는 다음과 같은 생명주기를 따른다:

| 상태          | 설명                                       |
|---------------|--------------------------------------------|
| NEW           | 스레드 객체가 생성되었으나 아직 시작되지 않음 |
| RUNNABLE      | 실행 가능 상태로, 스케줄러에 의해 실행 대기   |
| RUNNING       | 실제 CPU 자원을 할당받아 실행 중인 상태       |
| BLOCKED       | 락을 기다리는 중                           |
| WAITING       | 특정 조건이 발생할 때까지 대기              |
| TIMED_WAITING | 일정 시간 동안 대기                        |
| TERMINATED    | 실행이 완료되었거나 예외로 인해 종료된 상태   |

---

## 🔹 동기화(Synchronization)의 필요성

멀티스레딩 환경에서는 여러 스레드가 동시에 하나의 공유 자원에 접근할 경우, **데이터 충돌이나 불일치 문제가 발생**할 수 있다.  
이를 방지하기 위해 **동기화 메커니즘**을 사용하여 **단일 스레드만 접근**하도록 제어한다.

---

## 🔹 동기화 기법 비교

| 기법                      | 설명                                                  |
|---------------------------|-------------------------------------------------------|
| 객체/메서드 동기화        | 특정 블록 또는 메서드에 대해 synchronized 키워드 사용 |
| 클래스 레벨 동기화        | static 블록이나 메서드에 대해 클래스 단위 락 적용     |
| 명시적 Lock 객체 사용     | java.util.concurrent.locks 패키지의 Lock 사용         |
| volatile 키워드           | 변수 변경이 모든 스레드에 즉시 반영되도록 설정        |
| Atomic 클래스             | 원자성 보장 연산 제공 (ex: AtomicInteger 등)         |

---

## 🔹 데드락(Deadlock) 문제

**데드락**이란 두 개 이상의 스레드가 서로 상대방의 락을 기다리며 영원히 대기 상태에 빠지는 현상이다.  
발생 조건은 다음 네 가지가 모두 충족될 때:

1. 상호 배제 (Mutual Exclusion)
2. 점유 대기 (Hold and Wait)
3. 비선점 (No Preemption)
4. 순환 대기 (Circular Wait)

해결 방법:
- 락 획득 순서 통일
- 타임아웃 기반 락 처리
- 리팩토링을 통한 공유 자원 최소화

---

## 🔹 자바 동시성 유틸리티

Java는 동기화를 보다 효율적으로 다루기 위해 `java.util.concurrent` 패키지를 제공한다.  
주요 유틸리티는 다음과 같다:

| 클래스/인터페이스     | 역할 및 특징                                  |
|------------------------|-----------------------------------------------|
| ExecutorService        | 스레드 풀 관리, 비동기 작업 실행              |
| Future / Callable      | 비동기 작업 결과 반환                         |
| CountDownLatch         | 특정 조건까지 대기 후 실행                    |
| Semaphore              | 동시 접근 허용 개수 제한                      |
| ReentrantLock          | 명시적 락 구현체, 재진입 가능, 공정성 설정 가능 |

---

## 🔹 스레드 안전(Thread Safety) 확보 전략

1. 공유 자원 최소화
2. 불변 객체 사용
3. 동기화 블록 최소화
4. 동시성 컬렉션 사용 (`ConcurrentHashMap`, `CopyOnWriteArrayList` 등)
5. 로직 분리와 메시지 기반 설계 (Ex: Actor Model 개념 적용)

---

## ✅ 정리 요약

- 자바의 멀티스레드는 병렬성 확보를 위한 강력한 도구이지만, 데이터 정합성을 위해 동기화가 필수적이다.
- 동기화는 synchronized 키워드 외에도 다양한 고급 기법과 유틸리티를 통해 구현 가능하다.
- 스레드 안전성을 확보하기 위해서는 상태 공유를 최소화하고, 동시성 유틸리티를 적극 활용하는 것이 중요하다.
