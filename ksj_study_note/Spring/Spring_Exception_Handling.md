# 스프링의 예외 처리 방식과 전역 예외 처리 전략

---

## 🔹 예외 처리의 필요성

예외(Exception)는 프로그램 실행 중 발생하는 **비정상적인 상황**을 의미한다.  
스프링에서는 예외를 적절히 처리함으로써 **안정성, 유지보수성, 사용자 경험**을 확보할 수 있다.  
특히 API 서버 개발 시 예외 처리는 **에러 메시지 표준화, 에러 추적 가능성 확보**에 매우 중요하다.

---

## 🔹 스프링의 예외 처리 계층 구조

스프링 MVC는 예외를 다음과 같은 수준으로 처리할 수 있도록 지원한다:

1. **로컬 try-catch 블록**
2. **@ExceptionHandler (메서드 단위)**
3. **@ControllerAdvice 또는 @RestControllerAdvice (전역 처리)**

---

## 🔹 @ExceptionHandler

- 특정 컨트롤러 클래스 내부에서 발생한 예외를 처리할 수 있는 어노테이션
- 메서드에 선언하여 예외 유형에 따른 커스텀 로직 작성 가능

특징:
- 동일 클래스 내에서만 작동
- 하나의 메서드에서 여러 예외 유형 처리 가능
- 반환 타입은 자유롭게 설정 가능 (뷰, JSON, 텍스트 등)

---

## 🔹 @ControllerAdvice / @RestControllerAdvice

- 모든 컨트롤러에 공통적으로 적용되는 **전역 예외 처리 컴포넌트**
- `@ExceptionHandler`와 결합하여 전역에서 예외를 관리
- `@ControllerAdvice`: 뷰 기반 응답용 (HTML 등)
- `@RestControllerAdvice`: JSON 기반 응답용 (REST API 대응)

전역 예외 핸들링 구성:
- 하나의 Advice 클래스에 다양한 예외 처리 메서드 선언
- 커스텀 예외 클래스에 따른 세분화된 처리 가능
- 응답 포맷 통일 및 코드 일관성 확보

---

## 🔹 응답 포맷 통일 전략

예외 응답을 통일된 형식으로 반환하면 클라이언트에서 예측 가능하게 처리할 수 있다.

표준 응답 예시:

| 필드명     | 설명                           |
|------------|--------------------------------|
| `status`   | HTTP 상태 코드 (예: 400, 404) |
| `error`    | 에러 코드 또는 분류 이름       |
| `message`  | 사용자에게 보여줄 메시지        |
| `path`     | 요청 URL 경로                  |
| `timestamp`| 발생 시간                      |

---

## 🔹 예외 유형에 따른 설계 전략

| 예외 유형        | 설명                                       | 처리 전략                      |
|------------------|--------------------------------------------|-------------------------------|
| 비즈니스 예외     | 로직상 예외 상황 (예: 중복 이메일)         | 커스텀 예외로 분리하여 처리     |
| 시스템 예외       | DB, 네트워크 등 외부 오류                   | 로깅 후 일반화된 메시지 반환   |
| 프레임워크 예외   | Validation 실패, HTTP Method 불일치 등      | 전역 Advice로 일괄 처리        |

---

## 🔹 커스텀 예외 설계 방식

- `RuntimeException`을 상속하여 도메인별 예외 정의
- 예외에 메시지, 에러 코드, HTTP 상태 등을 포함
- 필요 시 인터페이스 또는 공통 베이스 예외 클래스 도입

이러한 설계를 통해 컨트롤러는 도메인 로직만 집중하고, 예외 처리 로직은 Advice가 전담하게 된다.

---

## 🔹 실무 적용 팁

1. 예외 메시지는 사용자 친화적으로 작성 (개발자 내부 정보 노출 금지)
2. 전역 Advice는 최대한 단순하고 명확하게 유지
3. 커스텀 예외는 도메인/기능 단위로 구분해 관리
4. API 응답 포맷은 사전에 정의하고 문서화 (Swagger 등과 연동 가능)

---

## ✅ 정리 요약

- 스프링은 다양한 수준의 예외 처리 메커니즘을 제공하며, 전역 예외 처리를 통해 코드 분리와 유지보수가 가능하다.
- `@RestControllerAdvice`와 `@ExceptionHandler` 조합은 REST API에서 가장 흔하게 사용되는 방식이다.
- 커스텀 예외와 응답 표준화는 실무에서 API 품질을 결정짓는 중요한 요소이다.
