# AOP (관점 지향 프로그래밍) 개념과 스프링 구현 방식

---

## 🔹 AOP란 무엇인가?

AOP(Aspect-Oriented Programming)는 **핵심 로직과는 별개의 공통 기능을 모듈화**하는 프로그래밍 기법이다.  
주로 **로깅, 트랜잭션, 보안, 예외 처리**처럼 여러 모듈에서 공통으로 발생하는 기능을 분리하여 코드 중복을 제거하고 유지보수성을 향상시킨다.

AOP는 OOP의 한계를 보완하며, **관심사의 분리(Separation of Concerns)**를 통해 코드의 구조적 명확성과 재사용성을 높인다.

---

## 🔹 스프링에서의 AOP 지원

Spring은 프록시 기반 AOP를 제공하며, 다음 두 가지 방식으로 구현할 수 있다:

1. **스프링 AOP (프록시 기반)**  
   - 스프링 IoC 컨테이너를 기반으로 작동  
   - 인터페이스 기반 (JDK 동적 프록시) 또는 클래스 기반 (CGLIB 프록시)

2. **AspectJ (컴파일/바이트코드 조작 기반)**  
   - 보다 정교한 AOP 구현 가능  
   - 애플리케이션 실행 전 또는 런타임에 바이트코드 조작 수행

---

## 🔹 AOP의 핵심 용어

| 용어        | 설명                                                                           |
|-------------|--------------------------------------------------------------------------------|
| Aspect      | 횡단 관심사 자체 (예: 로깅, 트랜잭션)                                            |
| Join Point  | Advice가 적용될 수 있는 시점 (메서드 실행 등)                                   |
| Advice      | 실제로 실행될 코드 (Before, After, Around 등)                                   |
| Pointcut    | Join Point 중 Advice를 적용할 지점 필터링                                       |
| Weaving     | Advice를 실제 대상 객체에 적용하는 과정 (프록시 조합 혹은 바이트코드 삽입 등)     |
| Target      | 실제로 비즈니스 로직을 수행하는 객체                                             |

---

## 🔹 스프링에서의 AOP 적용 흐름

1. 스프링 설정에서 AOP 활성화 (`@EnableAspectJAutoProxy` 또는 XML 설정)
2. Aspect 클래스 정의 (보통 `@Aspect` 사용)
3. Advice 메서드에 각종 어노테이션 선언 (`@Before`, `@AfterReturning`, `@Around` 등)
4. Pointcut 정의로 실행 대상 메서드 패턴 지정
5. 스프링 컨테이너가 해당 Bean을 프록시로 래핑하여 Advice 로직 삽입

---

## 🔹 Advice 종류

| Advice 유형           | 설명                                                    |
|------------------------|-----------------------------------------------------------|
| `@Before`             | 대상 메서드 실행 전 수행                                  |
| `@After`              | 대상 메서드 실행 후 (정상/예외 상관없이) 수행             |
| `@AfterReturning`     | 대상 메서드가 예외 없이 성공적으로 리턴된 후 수행         |
| `@AfterThrowing`      | 대상 메서드에서 예외 발생 시 실행                         |
| `@Around`             | 메서드 실행 전/후, 예외 처리까지 모두 포함 (가장 유연함)   |

---

## 🔹 Pointcut 표현식

스프링 AOP에서는 AspectJ 표현식을 사용하여 Pointcut을 정의한다.

주요 문법:

- `execution(* com.example.service.*.*(..))`  
  → com.example.service 패키지의 모든 클래스의 모든 메서드에 적용

- `within(com.example.controller..*)`  
  → 지정 패키지 이하 모든 클래스

- `@annotation(org.springframework.transaction.annotation.Transactional)`  
  → 특정 어노테이션이 붙은 메서드에만 적용

---

## 🔹 AOP 적용 시 고려사항

- **빈으로 등록되지 않은 객체는 AOP 적용 대상이 아니다.**
- **프록시 방식이기 때문에 final 클래스나 private 메서드는 적용되지 않을 수 있다.**
- **과도한 AOP 사용은 로직 추적을 어렵게 만들 수 있다.**
- **성능 영향 최소화를 위해 최소한의 Pointcut 범위를 유지해야 한다.**

---

## ✅ 정리 요약

- AOP는 핵심 로직과 공통 기능을 분리하여 코드 중복을 제거하고 유지보수성을 향상시키는 프로그래밍 패턴이다.
- 스프링은 프록시 기반의 AOP를 제공하며, `@Aspect`, `@Advice`, `@Pointcut` 등을 활용하여 선언적으로 구현할 수 있다.
- AOP는 잘 설계된 구조 아래에서 강력한 도구가 될 수 있지만, 남용 시 복잡성을 유발하므로 적절한 사용이 중요하다.
