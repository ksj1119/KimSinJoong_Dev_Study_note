# 스프링 빈의 라이프사이클

---

## 🔹 스프링 빈(Bean)이란?

Spring에서 **빈(Bean)**은 IoC 컨테이너가 생성하고 관리하는 객체를 말한다.  
애플리케이션의 구성 요소(서비스, DAO, 컨트롤러 등)를 빈으로 등록하면, **의존성 주입**, **라이프사이클 관리**, **AOP 적용** 등의 기능을 자동으로 수행할 수 있다.

---

## 🔹 빈의 생명주기(Lifecycle) 개요

스프링 빈은 다음과 같은 순서로 생성되고 소멸된다:

1. **컨테이너 초기화** (`ApplicationContext`)
2. **빈 인스턴스 생성** (new 키워드 혹은 리플렉션)
3. **의존성 주입** (DI)
4. **빈 초기화 메서드 실행** (옵션)
5. **빈 사용 가능 상태**
6. **빈 소멸 메서드 실행** (옵션)
7. **컨테이너 종료**

---

## 🔹 주요 인터페이스 기반 라이프사이클 콜백

| 인터페이스                      | 설명                                         |
|----------------------------------|----------------------------------------------|
| `InitializingBean`              | `afterPropertiesSet()` 호출로 초기화 수행     |
| `DisposableBean`                | `destroy()` 호출로 소멸 작업 수행            |
| `BeanNameAware`                 | 자신의 빈 이름 인식 가능                     |
| `ApplicationContextAware`       | ApplicationContext 참조 주입                 |
| `BeanPostProcessor`             | 초기화 전후에 공통 처리 로직 삽입 가능       |

이러한 인터페이스 기반 콜백은 프레임워크 중심의 제어 방식으로 사용된다.

---

## 🔹 어노테이션 기반 라이프사이클 관리

현대 스프링에서는 어노테이션 기반 방식이 선호된다.

- `@PostConstruct`: 의존성 주입 후 초기화 로직 실행
- `@PreDestroy`: 컨테이너 종료 직전 소멸 로직 실행

이 방식은 코드 간결성과 테스트 용이성을 동시에 만족시킨다.

---

## 🔹 커스텀 초기화/소멸 메서드 지정

자바 설정(`@Bean`) 또는 XML 설정에서 직접 초기화/소멸 메서드 지정이 가능하다.

- 자바 설정:
  - `@Bean(initMethod = "init", destroyMethod = "cleanup")`
- XML 설정:
  - `<bean init-method="init" destroy-method="cleanup" />`

이 방식은 어노테이션 또는 인터페이스를 사용할 수 없는 외부 라이브러리의 객체 초기화/정리 시에 유용하다.

---

## 🔹 BeanPostProcessor의 역할

빈의 생성 전후로 커스텀 로직을 적용하고 싶을 때 사용하는 **후처리기 인터페이스**이다.

적용 시점:

1. **생성 완료 후, 의존성 주입 전**
2. **초기화 메서드 호출 전후**

활용 예:
- AOP 적용
- 자동 프록시 생성
- 공통 설정 주입

---

## 🔹 빈 스코프와 라이프사이클의 관계

| 스코프       | 특징                                      | 라이프사이클 대상            |
|--------------|-------------------------------------------|-------------------------------|
| singleton    | 컨테이너당 단 하나의 인스턴스             | 컨테이너 전체 생명주기와 동일 |
| prototype    | 요청마다 새로운 인스턴스 생성              | 생성 후 바로 사용자에 반환됨  |
| request      | HTTP 요청마다 인스턴스 생성 (웹 전용)      | 요청 범위 동안 유지           |
| session      | HTTP 세션마다 인스턴스 생성 (웹 전용)      | 세션 종료 시 소멸             |

※ prototype 스코프의 빈은 **컨테이너가 소멸 메서드를 호출하지 않음**에 유의해야 한다.

---

## ✅ 정리 요약

- 스프링 빈은 ApplicationContext에 의해 관리되며, 생성부터 소멸까지 정해진 순서를 따라 동작한다.
- 빈의 초기화와 소멸은 인터페이스, 어노테이션, 또는 명시적 설정을 통해 커스터마이징할 수 있다.
- BeanPostProcessor를 활용하면 공통 처리 로직을 프레임워크 수준에서 삽입할 수 있으며, 이는 AOP나 자동 설정 등에 자주 사용된다.
- 빈의 스코프에 따라 라이프사이클 관리 방식이 달라지므로, 사용 목적에 따라 스코프 설정에 유의해야 한다.
